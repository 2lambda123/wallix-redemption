#include <stdio.h>
#include "test_keymap.hpp"
#include <stdlib.h>
#include <iostream>
#include <fstream>
#include <sstream>
#include <map>
#include <string>
#include <string.h>

using namespace std;

// ###############################################
void Keymap::keymap_init(const char * filename) {

    printf("   keymap_init FILE >> Entre\n");
    printf("      FIC = %s\n", filename);

    ifstream  Keymap_stream(filename);
    keymap_init(Keymap_stream);

    printf("   keymap_init FILE << Sort\n");
}

// ###############################################
void Keymap::keymap_init( istream & Keymap_stream )
{
    // keyboard info
    printf("      keymap_init STREAM >> Entre\n");


    try{
//        po::variables_map vm;
//        po::store(po::parse_config_file(Keymap_stream, Keymap_desc), vm);
//        po::notify(vm);

        char buffer[256];

        struct keydef {
            struct key_info (& ki)[128];
            const char * format;
        } keydef[5] = {
            { this->keys_noshift,      "noshift.Key%d"},
            { this->keys_shift,        "shift.Key%d"},
            { this->keys_altgr,        "altgr.Key%d"},
            { this->keys_capslock,     "capslock.Key%d"},
            { this->keys_shiftcapslock,"shiftcapslock.Key%d"}
        };
/*
        for (int kn = 0; kn < 5 ; kn++){
            for (int key_num = 8; key_num < 128; key_num++){
                sprintf(buffer, keydef[kn].format, key_num);
                string key(buffer);
                string key_tmp = vm[key].as<string>();
                const char * pos = ::index(key_tmp.data(), ':');
                if (pos){
                        keydef[kn].ki[key_num].chr = atoi(pos + 1);
                }
                keydef[kn].ki[key_num].sym = atoi(key_tmp.data());
            }
        }
*/
    } catch (exception& e){
        clog << "Exception raised " << e.what();
        LOG(LOG_ERR, "failed to read keymap, keyboard mapping is likely incomplete\n");
    };

    printf("      keymap_init STREAM >> Sort\n");
}

// ###############################################
void Keymap::keymap_tempo() {

    printf("      keymap_tempo >> Entre\n");

// Keyboard FR scancodes (km-040c)
std::stringstream stream_FR(
"[noshift]\n"
"Key8=0:0\n"
"Key9=65307:27\n"
"Key10=38:38\n"
"Key11=233:233\n"
"Key12=34:34\n"
"Key13=39:39\n"
"Key14=40:40\n"
"Key15=45:45\n"
"Key16=232:232\n"
"Key17=95:95\n"
"Key18=231:231\n"
"Key19=224:224\n"
"Key20=41:41\n"
"Key21=61:61\n"
"Key22=65288:8\n"
"Key23=65289:9\n"
"Key24=97:97\n"
"Key25=122:122\n"
"Key26=101:101\n"
"Key27=114:114\n"
"Key28=116:116\n"
"Key29=121:121\n"
"Key30=117:117\n"
"Key31=105:105\n"
"Key32=111:111\n"
"Key33=112:112\n"
"Key34=65106:94\n"
"Key35=36:36\n"
"Key36=65293:13\n"
"Key37=65507:0\n"
"Key38=113:113\n"
"Key39=115:115\n"
"Key40=100:100\n"
"Key41=102:102\n"
"Key42=103:103\n"
"Key43=104:104\n"
"Key44=106:106\n"
"Key45=107:107\n"
"Key46=108:108\n"
"Key47=109:109\n"
"Key48=249:249\n"
"Key49=178:178\n"
"Key50=65505:0\n"
"Key51=42:42\n"
"Key52=119:119\n"
"Key53=120:120\n"
"Key54=99:99\n"
"Key55=118:118\n"
"Key56=98:98\n"
"Key57=110:110\n"
"Key58=44:44\n"
"Key59=59:59\n"
"Key60=58:58\n"
"Key61=33:33\n"
"Key62=65506:0\n"
"Key63=65450:42\n"
"Key64=65513:0\n"
"Key65=32:32\n"
"Key66=65509:0\n"
"Key67=65470:0\n"
"Key68=65471:0\n"
"Key69=65472:0\n"
"Key70=65473:0\n"
"Key71=65474:0\n"
"Key72=65475:0\n"
"Key73=65476:0\n"
"Key74=65477:0\n"
"Key75=65478:0\n"
"Key76=65479:0\n"
"Key77=65407:0\n"
"Key78=65300:0\n"
"Key79=65429:0\n"
"Key80=65431:0\n"
"Key81=65434:0\n"
"Key82=65453:45\n"
"Key83=65430:0\n"
"Key84=65437:0\n"
"Key85=65432:0\n"
"Key86=65451:43\n"
"Key87=65436:0\n"
"Key88=65433:0\n"
"Key89=65435:0\n"
"Key90=65438:0\n"
"Key91=65439:0\n"
"Key92=0:0\n"
"Key93=65406:0\n"
"Key94=60:60\n"
"Key95=65480:0\n"
"Key96=65481:0\n"
"Key97=65360:0\n"
"Key98=65362:0\n"
"Key99=65365:0\n"
"Key100=65361:0\n"
"Key101=0:0\n"
"Key102=65363:0\n"
"Key103=65367:0\n"
"Key104=65364:0\n"
"Key105=65366:0\n"
"Key106=65379:0\n"
"Key107=65535:127\n"
"Key108=65421:13\n"
"Key109=65508:0\n"
"Key110=65299:0\n"
"Key111=65377:0\n"
"Key112=65455:47\n"
"Key113=65027:0\n"
"Key114=0:0\n"
"Key115=65515:0\n"
"Key116=65516:0\n"
"Key117=65383:0\n"
"Key118=0:0\n"
"Key119=0:0\n"
"Key120=0:0\n"
"Key121=0:0\n"
"Key122=0:0\n"
"Key123=0:0\n"
"Key124=65027:0\n"
"Key125=0:0\n"
"Key126=65469:61\n"
"Key127=0:0\n"
"Key128=0:0\n"
"Key129=0:0\n"
"Key130=0:0\n"
"Key131=0:0\n"
"Key132=0:0\n"
"Key133=0:0\n"
"Key134=0:0\n"
"Key135=0:0\n"
"Key136=0:0\n"
"Key137=0:0\n"
"[shift]\n"
"Key8=0:0\n"
"Key9=65307:27\n"
"Key10=49:49\n"
"Key11=50:50\n"
"Key12=51:51\n"
"Key13=52:52\n"
"Key14=53:53\n"
"Key15=54:54\n"
"Key16=55:55\n"
"Key17=56:56\n"
"Key18=57:57\n"
"Key19=48:48\n"
"Key20=176:176\n"
"Key21=43:43\n"
"Key22=65288:8\n"
"Key23=65056:0\n"
"Key24=65:65\n"
"Key25=90:90\n"
"Key26=69:69\n"
"Key27=82:82\n"
"Key28=84:84\n"
"Key29=89:89\n"
"Key30=85:85\n"
"Key31=73:73\n"
"Key32=79:79\n"
"Key33=80:80\n"
"Key34=65111:168\n"
"Key35=163:163\n"
"Key36=65293:13\n"
"Key37=65507:0\n"
"Key38=81:81\n"
"Key39=83:83\n"
"Key40=68:68\n"
"Key41=70:70\n"
"Key42=71:71\n"
"Key43=72:72\n"
"Key44=74:74\n"
"Key45=75:75\n"
"Key46=76:76\n"
"Key47=77:77\n"
"Key48=37:37\n"
"Key49=126:126\n"
"Key50=65505:0\n"
"Key51=181:181\n"
"Key52=87:87\n"
"Key53=88:88\n"
"Key54=67:67\n"
"Key55=86:86\n"
"Key56=66:66\n"
"Key57=78:78\n"
"Key58=63:63\n"
"Key59=46:46\n"
"Key60=47:47\n"
"Key61=167:167\n"
"Key62=65506:0\n"
"Key63=65450:42\n"
"Key64=65511:0\n"
"Key65=32:32\n"
"Key66=65509:0\n"
"Key67=65470:0\n"
"Key68=65471:0\n"
"Key69=65472:0\n"
"Key70=65473:0\n"
"Key71=65474:0\n"
"Key72=65475:0\n"
"Key73=65476:0\n"
"Key74=65477:0\n"
"Key75=65478:0\n"
"Key76=65479:0\n"
"Key77=65273:0\n"
"Key78=65300:0\n"
"Key79=65463:55\n"
"Key80=65464:56\n"
"Key81=65465:57\n"
"Key82=65453:45\n"
"Key83=65460:52\n"
"Key84=65461:53\n"
"Key85=65462:54\n"
"Key86=65451:43\n"
"Key87=65457:49\n"
"Key88=65458:50\n"
"Key89=65459:51\n"
"Key90=65456:48\n"
"Key91=65454:46\n"
"Key92=0:0\n"
"Key93=65406:0\n"
"Key94=62:62\n"
"Key95=65480:0\n"
"Key96=65481:0\n"
"Key97=65360:0\n"
"Key98=65362:0\n"
"Key99=65365:0\n"
"Key100=65361:0\n"
"Key101=0:0\n"
"Key102=65363:0\n"
"Key103=65367:0\n"
"Key104=65364:0\n"
"Key105=65366:0\n"
"Key106=65379:0\n"
"Key107=65535:127\n"
"Key108=65421:13\n"
"Key109=65508:0\n"
"Key110=65299:0\n"
"Key111=65377:0\n"
"Key112=65455:47\n"
"Key113=65027:0\n"
"Key114=0:0\n"
"Key115=65515:0\n"
"Key116=65516:0\n"
"Key117=65383:0\n"
"Key118=0:0\n"
"Key119=0:0\n"
"Key120=0:0\n"
"Key121=0:0\n"
"Key122=0:0\n"
"Key123=0:0\n"
"Key124=65027:0\n"
"Key125=65513:0\n"
"Key126=65469:61\n"
"Key127=65515:0\n"
"Key128=65517:0\n"
"Key129=0:0\n"
"Key130=0:0\n"
"Key131=0:0\n"
"Key132=0:0\n"
"Key133=0:0\n"
"Key134=0:0\n"
"Key135=0:0\n"
"Key136=0:0\n"
"Key137=0:0\n"
"[altgr]\n"
"Key8=0:0\n"
"Key9=65307:27\n"
"Key10=185:185\n"
"Key11=126:126\n"
"Key12=35:35\n"
"Key13=123:123\n"
"Key14=91:91\n"
"Key15=124:124\n"
"Key16=96:96\n"
"Key17=92:92\n"
"Key18=94:94\n"
"Key19=64:64\n"
"Key20=93:93\n"
"Key21=125:125\n"
"Key22=65288:8\n"
"Key23=65289:9\n"
"Key24=230:230\n"
"Key25=171:171\n"
"Key26=8364:8364\n"
"Key27=182:182\n"
"Key28=956:359\n"
"Key29=2299:8592\n"
"Key30=2302:8595\n"
"Key31=2301:8594\n"
"Key32=248:248\n"
"Key33=254:254\n"
"Key34=65111:168\n"
"Key35=164:164\n"
"Key36=65293:13\n"
"Key37=65507:0\n"
"Key38=64:64\n"
"Key39=223:223\n"
"Key40=240:240\n"
"Key41=496:273\n"
"Key42=959:331\n"
"Key43=689:295\n"
"Key44=106:106\n"
"Key45=930:312\n"
"Key46=435:322\n"
"Key47=181:181\n"
"Key48=65106:94\n"
"Key49=172:172\n"
"Key50=65505:0\n"
"Key51=65104:96\n"
"Key52=435:322\n"
"Key53=187:187\n"
"Key54=162:162\n"
"Key55=2770:8220\n"
"Key56=2771:8221\n"
"Key57=110:110\n"
"Key58=65105:180\n"
"Key59=2211:0\n"
"Key60=183:183\n"
"Key61=65120:0\n"
"Key62=65506:0\n"
"Key63=65450:42\n"
"Key64=65513:0\n"
"Key65=32:32\n"
"Key66=65509:0\n"
"Key67=65470:0\n"
"Key68=65471:0\n"
"Key69=65472:0\n"
"Key70=65473:0\n"
"Key71=65474:0\n"
"Key72=65475:0\n"
"Key73=65476:0\n"
"Key74=65477:0\n"
"Key75=65478:0\n"
"Key76=65479:0\n"
"Key77=65407:0\n"
"Key78=65300:0\n"
"Key79=65429:0\n"
"Key80=65431:0\n"
"Key81=65434:0\n"
"Key82=65453:45\n"
"Key83=65430:0\n"
"Key84=65437:0\n"
"Key85=65432:0\n"
"Key86=65451:43\n"
"Key87=65436:0\n"
"Key88=65433:0\n"
"Key89=65435:0\n"
"Key90=65438:0\n"
"Key91=65439:0\n"
"Key92=0:0\n"
"Key93=65406:0\n"
"Key94=124:124\n"
"Key95=65480:0\n"
"Key96=65481:0\n"
"Key97=65360:0\n"
"Key98=65362:0\n"
"Key99=65365:0\n"
"Key100=65361:0\n"
"Key101=0:0\n"
"Key102=65363:0\n"
"Key103=65367:0\n"
"Key104=65364:0\n"
"Key105=65366:0\n"
"Key106=65379:0\n"
"Key107=65535:127\n"
"Key108=65421:13\n"
"Key109=65508:0\n"
"Key110=65299:0\n"
"Key111=0:0\n"
"Key112=65455:47\n"
"Key113=65027:0\n"
"Key114=0:0\n"
"Key115=65515:0\n"
"Key116=65516:0\n"
"Key117=65383:0\n"
"Key118=0:0\n"
"Key119=0:0\n"
"Key120=0:0\n"
"Key121=0:0\n"
"Key122=0:0\n"
"Key123=0:0\n"
"Key124=65027:0\n"
"Key125=0:0\n"
"Key126=65469:61\n"
"Key127=0:0\n"
"Key128=0:0\n"
"Key129=0:0\n"
"Key130=0:0\n"
"Key131=0:0\n"
"Key132=0:0\n"
"Key133=0:0\n"
"Key134=0:0\n"
"Key135=0:0\n"
"Key136=0:0\n"
"Key137=0:0\n"
"[capslock]\n"
"Key8=0:0\n"
"Key9=65307:27\n"
"Key10=38:38\n"
"Key11=201:201\n"
"Key12=34:34\n"
"Key13=39:39\n"
"Key14=40:40\n"
"Key15=45:45\n"
"Key16=200:200\n"
"Key17=95:95\n"
"Key18=199:199\n"
"Key19=192:192\n"
"Key20=41:41\n"
"Key21=61:61\n"
"Key22=65288:8\n"
"Key23=65289:9\n"
"Key24=65:65\n"
"Key25=90:90\n"
"Key26=69:69\n"
"Key27=82:82\n"
"Key28=84:84\n"
"Key29=89:89\n"
"Key30=85:85\n"
"Key31=73:73\n"
"Key32=79:79\n"
"Key33=80:80\n"
"Key34=65106:94\n"
"Key35=36:36\n"
"Key36=65293:13\n"
"Key37=65507:0\n"
"Key38=81:81\n"
"Key39=83:83\n"
"Key40=68:68\n"
"Key41=70:70\n"
"Key42=71:71\n"
"Key43=72:72\n"
"Key44=74:74\n"
"Key45=75:75\n"
"Key46=76:76\n"
"Key47=77:77\n"
"Key48=217:217\n"
"Key49=178:178\n"
"Key50=65505:0\n"
"Key51=42:42\n"
"Key52=87:87\n"
"Key53=88:88\n"
"Key54=67:67\n"
"Key55=86:86\n"
"Key56=66:66\n"
"Key57=78:78\n"
"Key58=44:44\n"
"Key59=59:59\n"
"Key60=58:58\n"
"Key61=33:33\n"
"Key62=65506:0\n"
"Key63=65450:42\n"
"Key64=65513:0\n"
"Key65=32:32\n"
"Key66=65509:0\n"
"Key67=65470:0\n"
"Key68=65471:0\n"
"Key69=65472:0\n"
"Key70=65473:0\n"
"Key71=65474:0\n"
"Key72=65475:0\n"
"Key73=65476:0\n"
"Key74=65477:0\n"
"Key75=65478:0\n"
"Key76=65479:0\n"
"Key77=65407:0\n"
"Key78=65300:0\n"
"Key79=65429:0\n"
"Key80=65431:0\n"
"Key81=65434:0\n"
"Key82=65453:45\n"
"Key83=65430:0\n"
"Key84=65437:0\n"
"Key85=65432:0\n"
"Key86=65451:43\n"
"Key87=65436:0\n"
"Key88=65433:0\n"
"Key89=65435:0\n"
"Key90=65438:0\n"
"Key91=65439:0\n"
"Key92=0:0\n"
"Key93=65406:0\n"
"Key94=60:60\n"
"Key95=65480:0\n"
"Key96=65481:0\n"
"Key97=65360:0\n"
"Key98=65362:0\n"
"Key99=65365:0\n"
"Key100=65361:0\n"
"Key101=0:0\n"
"Key102=65363:0\n"
"Key103=65367:0\n"
"Key104=65364:0\n"
"Key105=65366:0\n"
"Key106=65379:0\n"
"Key107=65535:127\n"
"Key108=65421:13\n"
"Key109=65508:0\n"
"Key110=65299:0\n"
"Key111=65377:0\n"
"Key112=65455:47\n"
"Key113=65027:0\n"
"Key114=0:0\n"
"Key115=65515:0\n"
"Key116=65516:0\n"
"Key117=65383:0\n"
"Key118=0:0\n"
"Key119=0:0\n"
"Key120=0:0\n"
"Key121=0:0\n"
"Key122=0:0\n"
"Key123=0:0\n"
"Key124=65027:0\n"
"Key125=0:0\n"
"Key126=65469:61\n"
"Key127=0:0\n"
"Key128=0:0\n"
"Key129=0:0\n"
"Key130=0:0\n"
"Key131=0:0\n"
"Key132=0:0\n"
"Key133=0:0\n"
"Key134=0:0\n"
"Key135=0:0\n"
"Key136=0:0\n"
"Key137=0:0\n"
"[shiftcapslock]\n"
"Key8=0:0\n"
"Key9=65307:27\n"
"Key10=49:49\n"
"Key11=50:50\n"
"Key12=51:51\n"
"Key13=52:52\n"
"Key14=53:53\n"
"Key15=54:54\n"
"Key16=55:55\n"
"Key17=56:56\n"
"Key18=57:57\n"
"Key19=48:48\n"
"Key20=176:176\n"
"Key21=43:43\n"
"Key22=65288:8\n"
"Key23=65056:0\n"
"Key24=97:97\n"
"Key25=122:122\n"
"Key26=101:101\n"
"Key27=114:114\n"
"Key28=116:116\n"
"Key29=121:121\n"
"Key30=117:117\n"
"Key31=105:105\n"
"Key32=111:111\n"
"Key33=112:112\n"
"Key34=65111:168\n"
"Key35=163:163\n"
"Key36=65293:13\n"
"Key37=65507:0\n"
"Key38=113:113\n"
"Key39=115:115\n"
"Key40=100:100\n"
"Key41=102:102\n"
"Key42=103:103\n"
"Key43=104:104\n"
"Key44=106:106\n"
"Key45=107:107\n"
"Key46=108:108\n"
"Key47=109:109\n"
"Key48=37:37\n"
"Key49=126:126\n"
"Key50=65505:0\n"
"Key51=924:0\n"
"Key52=119:119\n"
"Key53=120:120\n"
"Key54=99:99\n"
"Key55=118:118\n"
"Key56=98:98\n"
"Key57=110:110\n"
"Key58=63:63\n"
"Key59=46:46\n"
"Key60=47:47\n"
"Key61=167:167\n"
"Key62=65506:0\n"
"Key63=65450:42\n"
"Key64=65511:0\n"
"Key65=32:32\n"
"Key66=65509:0\n"
"Key67=65470:0\n"
"Key68=65471:0\n"
"Key69=65472:0\n"
"Key70=65473:0\n"
"Key71=65474:0\n"
"Key72=65475:0\n"
"Key73=65476:0\n"
"Key74=65477:0\n"
"Key75=65478:0\n"
"Key76=65479:0\n"
"Key77=65273:0\n"
"Key78=65300:0\n"
"Key79=65463:55\n"
"Key80=65464:56\n"
"Key81=65465:57\n"
"Key82=65453:45\n"
"Key83=65460:52\n"
"Key84=65461:53\n"
"Key85=65462:54\n"
"Key86=65451:43\n"
"Key87=65457:49\n"
"Key88=65458:50\n"
"Key89=65459:51\n"
"Key90=65456:48\n"
"Key91=65454:46\n"
"Key92=0:0\n"
"Key93=65406:0\n"
"Key94=62:62\n"
"Key95=65480:0\n"
"Key96=65481:0\n"
"Key97=65360:0\n"
"Key98=65362:0\n"
"Key99=65365:0\n"
"Key100=65361:0\n"
"Key101=0:0\n"
"Key102=65363:0\n"
"Key103=65367:0\n"
"Key104=65364:0\n"
"Key105=65366:0\n"
"Key106=65379:0\n"
"Key107=65535:127\n"
"Key108=65421:13\n"
"Key109=65508:0\n"
"Key110=65299:0\n"
"Key111=65377:0\n"
"Key112=65455:47\n"
"Key113=65027:0\n"
"Key114=0:0\n"
"Key115=65515:0\n"
"Key116=65516:0\n"
"Key117=65383:0\n"
"Key118=0:0\n"
"Key119=0:0\n"
"Key120=0:0\n"
"Key121=0:0\n"
"Key122=0:0\n"
"Key123=0:0\n"
"Key124=65027:0\n"
"Key125=65513:0\n"
"Key126=65469:61\n"
"Key127=65515:0\n"
"Key128=65517:0\n"
"Key129=0:0\n"
"Key130=0:0\n"
"Key131=0:0\n"
"Key132=0:0\n"
"Key133=0:0\n"
"Key134=0:0\n"
"Key135=0:0\n"
"Key136=0:0\n"
"Key137=0:0");

// Keyboard DEFAULT scancodes
std::stringstream stream_FR(
"[noshift]\n"
"Key8=0:0"\n"
"Key9=65307:27\n"
"Key10=49:49\n"
"Key11=50:50\n"
"Key12=51:51\n"
"Key13=52:52\n"
"Key14=53:53\n"
"Key15=54:54\n"
"Key16=55:55\n"
"Key17=56:56\n"
"Key18=57:57\n"
"Key19=48:48\n"
"Key20=223:223\n"
"Key21=65105:180\n"
"Key22=65288:8\n"
"Key23=65289:9\n"
"Key24=113:113\n"
"Key25=119:119\n"
"Key26=101:101\n"
"Key27=114:114\n"
"Key28=116:116\n"
"Key29=122:122\n"
"Key30=117:117\n"
"Key31=105:105\n"
"Key32=111:111\n"
"Key33=112:112\n"
"Key34=252:252\n"
"Key35=43:43\n"
"Key36=65293:13\n"
"Key37=65507:0\n"
"Key38=97:97\n"
"Key39=115:115\n"
"Key40=100:100\n"
"Key41=102:102\n"
"Key42=103:103\n"
"Key43=104:104\n"
"Key44=106:106\n"
"Key45=107:107\n"
"Key46=108:108\n"
"Key47=246:246\n"
"Key48=228:228\n"
"Key49=65106:94\n"
"Key50=65505:0\n"
"Key51=35:35\n"
"Key52=121:121\n"
"Key53=120:120\n"
"Key54=99:99\n"
"Key55=118:118\n"
"Key56=98:98\n"
"Key57=110:110\n"
"Key58=109:109\n"
"Key59=44:44\n"
"Key60=46:46\n"
"Key61=45:45\n"
"Key62=65506:0\n"
"Key63=65450:42\n"
"Key64=65513:0\n"
"Key65=32:32\n"
"Key66=65509:0\n"
"Key67=65470:0\n"
"Key68=65471:0\n"
"Key69=65472:0\n"
"Key70=65473:0\n"
"Key71=65474:0\n"
"Key72=65475:0\n"
"Key73=65476:0\n"
"Key74=65477:0\n"
"Key75=65478:0\n"
"Key76=65479:0\n"
"Key77=65407:0\n"
"Key78=65300:0\n"
"Key79=65429:0\n"
"Key80=65431:0\n"
"Key81=65434:0\n"
"Key82=65453:45\n"
"Key83=65430:0\n"
"Key84=65437:0\n"
"Key85=65432:0\n"
"Key86=65451:43\n"
"Key87=65436:0\n"
"Key88=65433:0\n"
"Key89=65435:0\n"
"Key90=65438:0\n"
"Key91=65439:0\n"
"Key92=0:0\n"
"Key93=65406:0\n"
"Key94=60:60\n"
"Key95=65480:0\n"
"Key96=65481:0\n"
"Key97=65360:0\n"
"Key98=65362:0\n"
"Key99=65365:0\n"
"Key100=65361:0\n"
"Key101=0:0\n"
"Key102=65363:0\n"
"Key103=65367:0\n"
"Key104=65364:0\n"
"Key105=65366:0\n"
"Key106=65379:0\n"
"Key107=65535:127\n"
"Key108=65421:13\n"
"Key109=65508:0\n"
"Key110=65299:0\n"
"Key111=65377:0\n"
"Key112=65455:47\n"
"Key113=65027:0\n"
"Key114=0:0\n"
"Key115=65515:0\n"
"Key116=65516:0\n"
"Key117=65383:0\n"
"Key118=0:0\n"
"Key119=0:0\n"
"Key120=0:0\n"
"Key121=0:0\n"
"Key122=0:0\n"
"Key123=0:0\n"
"Key124=65027:0\n"
"Key125=0:0\n"
"Key126=65469:61\n"
"Key127=0:0\n"
"Key128=0:0\n"
"Key129=0:0\n"
"Key130=0:0\n"
"Key131=0:0\n"
"Key132=0:0\n"
"Key133=0:0\n"
"Key134=0:0\n"
"Key135=0:0\n"
"Key136=0:0\n"
"Key137=0:0\n"
[shift]
"Key8=0:0\n"
"Key9=65307:27\n"
"Key10=33:33\n"
"Key11=34:34\n"
"Key12=167:167\n"
"Key13=36:36\n"
"Key14=37:37\n"
"Key15=38:38\n"
"Key16=47:47\n"
"Key17=40:40\n"
"Key18=41:41\n"
"Key19=61:61\n"
"Key20=63:63\n"
"Key21=65104:96\n"
"Key22=65288:8\n"
"Key23=65056:0\n"
"Key24=81:81\n"
"Key25=87:87\n"
"Key26=69:69\n"
"Key27=82:82\n"
"Key28=84:84\n"
"Key29=90:90\n"
"Key30=85:85\n"
"Key31=73:73\n"
"Key32=79:79\n"
"Key33=80:80\n"
"Key34=220:220\n"
"Key35=42:42\n"
"Key36=65293:13\n"
"Key37=65507:0\n"
"Key38=65:65\n"
"Key39=83:83\n"
"Key40=68:68\n"
"Key41=70:70\n"
"Key42=71:71\n"
"Key43=72:72\n"
"Key44=74:74\n"
"Key45=75:75\n"
"Key46=76:76\n"
"Key47=214:214\n"
"Key48=196:196\n"
"Key49=176:176\n"
"Key50=65505:0\n"
"Key51=39:39\n"
"Key52=89:89\n"
"Key53=88:88\n"
"Key54=67:67\n"
"Key55=86:86\n"
"Key56=66:66\n"
"Key57=78:78\n"
"Key58=77:77\n"
"Key59=59:59\n"
"Key60=58:58\n"
"Key61=95:95\n"
"Key62=65506:0\n"
"Key63=65450:42\n"
"Key64=65511:0\n"
"Key65=32:32\n"
"Key66=65509:0\n"
"Key67=65470:0\n"
"Key68=65471:0\n"
"Key69=65472:0\n"
"Key70=65473:0\n"
"Key71=65474:0\n"
"Key72=65475:0\n"
"Key73=65476:0\n"
"Key74=65477:0\n"
"Key75=65478:0\n"
"Key76=65479:0\n"
"Key77=65273:0\n"
"Key78=65300:0\n"
"Key79=65463:55\n"
"Key80=65464:56\n"
"Key81=65465:57\n"
"Key82=65453:45\n"
"Key83=65460:52\n"
"Key84=65461:53\n"
"Key85=65462:54\n"
"Key86=65451:43\n"
"Key87=65457:49\n"
"Key88=65458:50\n"
"Key89=65459:51\n"
"Key90=65456:48\n"
"Key91=65452:44\n"
"Key92=0:0\n"
"Key93=65406:0\n"
"Key94=62:62\n"
"Key95=65480:0\n"
"Key96=65481:0\n"
"Key97=65360:0\n"
"Key98=65362:0\n"
"Key99=65365:0\n"
"Key100=65361:0\n"
"Key101=0:0\n"
"Key102=65363:0\n"
"Key103=65367:0\n"
"Key104=65364:0\n"
"Key105=65366:0\n"
"Key106=65379:0\n"
"Key107=65535:127\n"
"Key108=65421:13\n"
"Key109=65508:0\n"
"Key110=65299:0\n"
"Key111=65377:0\n"
"Key112=65455:47\n"
"Key113=65027:0\n"
"Key114=0:0\n"
"Key115=65515:0\n"
"Key116=65516:0\n"
"Key117=65383:0\n"
"Key118=0:0\n"
"Key119=0:0\n"
"Key120=0:0\n"
"Key121=0:0\n"
"Key122=0:0\n"
"Key123=0:0\n"
"Key124=65027:0\n"
"Key125=65513:0\n"
"Key126=65469:61\n"
"Key127=65515:0\n"
"Key128=65517:0\n"
"Key129=0:0\n"
"Key130=0:0\n"
"Key131=0:0\n"
"Key132=0:0\n"
"Key133=0:0\n"
"Key134=0:0\n"
"Key135=0:0\n"
"Key136=0:0\n"
"Key137=0:0\n"
[altgr]
"Key8=0:0\n"
"Key9=65307:27\n"
"Key10=185:185\n"
"Key11=178:178\n"
"Key12=179:179\n"
"Key13=188:188\n"
"Key14=189:189\n"
"Key15=172:172\n"
"Key16=123:123\n"
"Key17=91:91\n"
"Key18=93:93\n"
"Key19=125:125\n"
"Key20=92:92\n"
"Key21=65115:184\n"
"Key22=65288:8\n"
"Key23=65289:9\n"
"Key24=64:64\n"
:%s/"Key25=435:322\n"
"Key26=8364:8364\n"
"Key27=182:182\n"
"Key28=956:359\n"
"Key29=2299:8592\n"
"Key30=2302:8595\n"
"Key31=2301:8594\n"
"Key32=248:248\n"
"Key33=254:254\n"
"Key34=65111:168\n"
"Key35=65107:126\n"
"Key36=65293:13\n"
"Key37=65507:0\n"
"Key38=230:230\n"
"Key39=223:223\n"
"Key40=240:240\n"
"Key41=496:273\n"
"Key42=959:331\n"
"Key43=689:295\n"
"Key44=106:106\n"
"Key45=930:312\n"
"Key46=435:322\n"
"Key47=65113:733\n"
"Key48=65106:94\n"
"Key49=172:172\n"
"Key50=65505:0\n"
"Key51=65104:96\n"
"Key52=171:171\n"
"Key53=187:187\n"
"Key54=162:162\n"
"Key55=2770:8220\n"
"Key56=2771:8221\n"
"Key57=110:110\n"
"Key58=181:181\n"
"Key59=2211:0\n"
"Key60=183:183\n"
"Key61=65120:0\n"
"Key62=65506:0\n"
"Key63=65450:42\n"
"Key64=65513:0\n"
"Key65=32:32\n"
"Key66=65509:0\n"
"Key67=65470:0\n"
"Key68=65471:0\n"
"Key69=65472:0\n"
"Key70=65473:0\n"
"Key71=65474:0\n"
"Key72=65475:0\n"
"Key73=65476:0\n"
"Key74=65477:0\n"
"Key75=65478:0\n"
"Key76=65479:0\n"
"Key77=65407:0\n"
"Key78=65300:0\n"
"Key79=65429:0\n"
"Key80=65431:0\n"
"Key81=65434:0\n"
"Key82=65453:45\n"
"Key83=65430:0\n"
"Key84=65437:0\n"
"Key85=65432:0\n"
"Key86=65451:43\n"
"Key87=65436:0\n"
"Key88=65433:0\n"
"Key89=65435:0\n"
"Key90=65438:0\n"
"Key91=65439:0\n"
"Key92=0:0\n"
"Key93=65406:0\n"
"Key94=124:124\n"
"Key95=65480:0\n"
"Key96=65481:0\n"
"Key97=65360:0\n"
"Key98=65362:0\n"
"Key99=65365:0\n"
"Key100=65361:0\n"
"Key101=0:0\n"
"Key102=65363:0\n"
"Key103=65367:0\n"
"Key104=65364:0\n"
"Key105=65366:0\n"
"Key106=65379:0\n"
"Key107=65535:127\n"
"Key108=65421:13\n"
"Key109=65508:0\n"
"Key110=65299:0\n"
"Key111=0:0\n"
"Key112=65455:47\n"
"Key113=65027:0\n"
"Key114=0:0\n"
"Key115=65515:0\n"
"Key116=65516:0\n"
"Key117=65383:0\n"
"Key118=0:0\n"
"Key119=0:0\n"
"Key120=0:0\n"
"Key121=0:0\n"
"Key122=0:0\n"
"Key123=0:0\n"
"Key124=65027:0\n"
"Key125=0:0\n"
"Key126=65469:61\n"
"Key127=0:0\n"
"Key128=0:0\n"
"Key129=0:0\n"
"Key130=0:0\n"
"Key131=0:0\n"
"Key132=0:0\n"
"Key133=0:0\n"
"Key134=0:0\n"
"Key135=0:0\n"
"Key136=0:0\n"
"Key137=0:0\n"
[capslock]
"Key8=0:0\n"
"Key9=65307:27\n"
"Key10=49:49\n"
"Key11=50:50\n"
"Key12=51:51\n"
"Key13=52:52\n"
"Key14=53:53\n"
"Key15=54:54\n"
"Key16=55:55\n"
"Key17=56:56\n"
"Key18=57:57\n"
"Key19=48:48\n"
"Key20=223:223\n"
"Key21=65105:180\n"
"Key22=65288:8\n"
"Key23=65289:9\n"
"Key24=81:81\n"
"Key25=87:87\n"
"Key26=69:69\n"
"Key27=82:82\n"
"Key28=84:84\n"
"Key29=90:90\n"
"Key30=85:85\n"
"Key31=73:73\n"
"Key32=79:79\n"
"Key33=80:80\n"
"Key34=220:220\n"
"Key35=43:43\n"
"Key36=65293:13\n"
"Key37=65507:0\n"
"Key38=65:65\n"
"Key39=83:83\n"
"Key40=68:68\n"
"Key41=70:70\n"
"Key42=71:71\n"
"Key43=72:72\n"
"Key44=74:74\n"
"Key45=75:75\n"
"Key46=76:76\n"
"Key47=214:214\n"
"Key48=196:196\n"
"Key49=65106:94\n"
"Key50=65505:0\n"
"Key51=35:35\n"
"Key52=89:89\n"
"Key53=88:88\n"
"Key54=67:67\n"
"Key55=86:86\n"
"Key56=66:66\n"
"Key57=78:78\n"
"Key58=77:77\n"
"Key59=44:44\n"
"Key60=46:46\n"
"Key61=45:45\n"
"Key62=65506:0\n"
"Key63=65450:42\n"
"Key64=65513:0\n"
"Key65=32:32\n"
"Key66=65509:0\n"
"Key67=65470:0\n"
"Key68=65471:0\n"
"Key69=65472:0\n"
"Key70=65473:0\n"
"Key71=65474:0\n"
"Key72=65475:0\n"
"Key73=65476:0\n"
"Key74=65477:0\n"
"Key75=65478:0\n"
"Key76=65479:0\n"
"Key77=65407:0\n"
"Key78=65300:0\n"
"Key79=65429:0\n"
"Key80=65431:0\n"
"Key81=65434:0\n"
"Key82=65453:45\n"
"Key83=65430:0\n"
"Key84=65437:0\n"
"Key85=65432:0\n"
"Key86=65451:43\n"
"Key87=65436:0\n"
"Key88=65433:0\n"
"Key89=65435:0\n"
"Key90=65438:0\n"
"Key91=65439:0\n"
"Key92=0:0\n"
"Key93=65406:0\n"
"Key94=60:60\n"
"Key95=65480:0\n"
"Key96=65481:0\n"
"Key97=65360:0\n"
"Key98=65362:0\n"
"Key99=65365:0\n"
"Key100=65361:0\n"
"Key101=0:0\n"
"Key102=65363:0\n"
"Key103=65367:0\n"
"Key104=65364:0\n"
"Key105=65366:0\n"
"Key106=65379:0\n"
"Key107=65535:127\n"
"Key108=65421:13\n"
"Key109=65508:0\n"
"Key110=65299:0\n"
"Key111=65377:0\n"
"Key112=65455:47\n"
"Key113=65027:0\n"
"Key114=0:0\n"
"Key115=65515:0\n"
"Key116=65516:0\n"
"Key117=65383:0\n"
"Key118=0:0\n"
"Key119=0:0\n"
"Key120=0:0\n"
"Key121=0:0\n"
"Key122=0:0\n"
"Key123=0:0\n"
"Key124=65027:0\n"
"Key125=0:0\n"
"Key126=65469:61\n"
"Key127=0:0\n"
"Key128=0:0\n"
"Key129=0:0\n"
"Key130=0:0\n"
"Key131=0:0\n"
"Key132=0:0\n"
"Key133=0:0\n"
"Key134=0:0\n"
"Key135=0:0\n"
"Key136=0:0\n"
"Key137=0:0\n"
[shiftcapslock]
"Key8=\n"
"Key9=\n"
"Key10=\n"
"Key11=\n"
"Key12=\n"
"Key13=\n"
"Key14=\n"
"Key15=\n"
"Key16=\n"
"Key17=\n"
"Key18=\n"
"Key19=\n"
"Key20=\n"
"Key21=\n"
"Key22=\n"
"Key23=\n"
"Key24=\n"
"Key25=\n"
"Key26=\n"
"Key27=\n"
"Key28=\n"
"Key29=\n"
"Key30=\n"
"Key31=\n"
"Key32=\n"
"Key33=\n"
"Key34=\n"
"Key35=\n"
"Key36=\n"
"Key37=\n"
"Key38=\n"
"Key39=\n"
"Key40=\n"
"Key41=\n"
"Key42=\n"
"Key43=\n"
"Key44=\n"
"Key45=\n"
"Key46=\n"
"Key47=\n"
"Key48=\n"
"Key49=\n"
"Key50=\n"
"Key51=\n"
"Key52=\n"
"Key53=\n"
"Key54=\n"
"Key55=\n"
"Key56=\n"
"Key57=\n"
"Key58=\n"
"Key59=\n"
"Key60=\n"
"Key61=\n"
"Key62=\n"
"Key63=\n"
"Key64=\n"
"Key65=\n"
"Key66=\n"
"Key67=\n"
"Key68=\n"
"Key69=\n"
"Key70=\n"
"Key71=\n"
"Key72=\n"
"Key73=\n"
"Key74=\n"
"Key75=\n"
"Key76=\n"
"Key77=\n"
"Key78=\n"
"Key79=\n"
"Key80=\n"
"Key81=\n"
"Key82=\n"
"Key83=\n"
"Key84=\n"
"Key85=\n"
"Key86=\n"
"Key87=\n"
"Key88=\n"
"Key89=\n"
"Key90=\n"
"Key91=\n"
"Key92=\n"
"Key93=\n"
"Key94=\n"
"Key95=\n"
"Key96=\n"
"Key97=\n"
"Key98=\n"
"Key99=\n"
"Key100=\n"
"Key101=\n"
"Key102=\n"
"Key103=\n"
"Key104=\n"
"Key105=\n"
"Key106=\n"
"Key107=\n"
"Key108=\n"
"Key109=\n"
"Key110=\n"
"Key111=\n"
"Key112=\n"
"Key113=\n"
"Key114=\n"
"Key115=\n"
"Key116=\n"
"Key117=\n"
"Key118=\n"
"Key119=\n"
"Key120=\n"
"Key121=\n"
"Key122=\n"
"Key123=\n"
"Key124=\n"
"Key125=\n"
"Key126=\n"
"Key127=\n"
"Key128=\n"
"Key129=\n"
"Key130=\n"
"Key131=\n"
"Key132=\n"
"Key133=\n"
"Key134=\n"
"Key135=\n"
"Key136=\n"
"Key137=\n"
);



static struct key {
            uint8_t code1;
            uint8_t code2;
        } map[128] =  {
            {   0,   0 }, {   9,   0 }, {  10,   0 }, {  11,   0 }, {  12,   0 }, //   0 -   4
            {  13,   0 }, {  14,   0 }, {  15,   0 }, {  16,   0 }, {  17,   0 }, //   5 -   9
            {  18,   0 }, {  19,   0 }, {  20,   0 }, {  21,   0 }, {  22,   0 }, //  10 -  14
            {  23,   0 }, {  24,   0 }, {  25,   0 }, {  26,   0 }, {  27,   0 }, //  15 -  19
            {  28,   0 }, {  29,   0 }, {  30,   0 }, {  31,   0 }, {  32,   0 }, //  20 -  24
            {  33,   0 }, {  34,   0 }, {  35,   0 }, {  36, 108 }, {  37, 109 }, //  25 -  29
            {  38,   0 }, {  39,   0 }, {  40,   0 }, {  41,   0 }, {  42,   0 }, //  30 -  34
            {  43,   0 }, {  44,   0 }, {  45,   0 }, {  46,   0 }, {  47,   0 }, //  35 -  39
            {  48,   0 }, {  49,   0 }, {  50,   0 }, {  51,   0 }, {  52,   0 }, //  40 -  44
            {  53,   0 }, {  54,   0 }, {  55,   0 }, {  56,   0 }, {  57,   0 }, //  45 -  49
            {  58,   0 }, {  59,   0 }, {  60,   0 }, {  61, 112 }, {  62,   0 }, //  50 -  54
            {  63, 111 }, {  64, 113 }, {  65,   0 }, {  66,   0 }, {  67,   0 }, //  55 -  59
            {  68,   0 }, {  69,   0 }, {  70,   0 }, {  71,   0 }, {  72,   0 }, //  60 -  64
            {  73,   0 }, {  74,   0 }, {  75,   0 }, {  76,   0 }, {  77,   0 }, //  65 -  69
            {  78,   0 }, {  79,  97 }, {  80,  98 }, {  81,  99 }, {  82,   0 }, //  70 -  74
            {  83, 100 }, {  84,   0 }, {  85, 102 }, {  86,   0 }, {  87, 103 }, //  75 -  79
            {  88, 104 }, {  89, 105 }, {  90, 106 }, {  91, 107 }, {  92,   0 }, //  80 -  84
            {  93,   0 }, {  94,   0 }, {  95,   0 }, {  96,   0 }, {  97,   0 }, //  85 -  89
            {  98,   0 }, {   0, 115 }, {   0, 116 }, {   0, 117 }, { 102,   0 }, //  90 -  94
            { 103,   0 }, { 104,   0 }, { 105,   0 }, { 106,   0 }, { 107,   0 }, //  95 -  99
            { 108,   0 }, { 109,   0 }, { 110,   0 }, { 111,   0 }, { 112,   0 }, // 100 - 104
            { 113,   0 }, { 114,   0 }, { 115,   0 }, { 116,   0 }, { 117,   0 }, // 105 - 109
            { 118,   0 }, { 119,   0 }, { 120,   0 }, { 121,   0 }, { 122,   0 }, // 110 - 114
            { 123,   0 }, { 124,   0 }, { 125,   0 }, { 126,   0 }, { 127,   0 }, // 115 - 119
            { 128,   0 }, { 129,   0 }, { 130,   0 }, { 131,   0 }, { 132,   0 }, // 120 - 124
            { 133,   0 }, { 134,   0 }, { 135,   0 }                              // 125 - 127
        };
    Keymap keymap_test;
    test_keymap.keymap_init(stream_FR);

    for (int key_num = 8; key_num < 128; key_num++){
        printf("{%5u, %5u}, // %u\n", test_keymap.keys_shift[key_num].sym, test_keymap.keys_noshift[key_num].chr, key_num);
    }

    printf("      keymap_tempo >> Sort\n");

} // keymap_tempo

// ###############################################
int main() {
    printf("DEBUT TKM\n");

    Keymap keymap;

    keymap.keymap_init("./src//km-0409.ini");

    keymap.keymap_tempo();

    printf("FIN TKM\n");

    return 0;
}
